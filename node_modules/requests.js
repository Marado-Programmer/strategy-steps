const processRequest = require("processRequest");
const net = require('net');

const application = processRequest(3000);

let client;

application.get("/", (req, res) => {
  client = net.connect(8080);

  client.on("end", data => {
    console.log('disconnected from server')
  
    process.exit();
  });
  
  client.on("error", e => console.error(e.toString()));

  res.setHeader("Content-Type", "text/html");

  res.write("<form method=\"post\">");
  res.write("<button type=\"submit\" name=\"secretNumber\" value=\"1\">1</button>");
  res.write("<button type=\"submit\" name=\"secretNumber\" value=\"2\">2</button>");
  res.write("<button type=\"submit\" name=\"secretNumber\" value=\"3\">3</button>");
  res.write("</form>");

	res.end();
});

application.post("/", (req, res) => {
  req.on("data", data => {
    client.write(data.toString());
  });

  res.statusCode = 301;
  res.setHeader("Location", "http://localhost:3000/");

  res.end();
});
